<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%> <%	String path = request.getContextPath();	String basePath = request.getScheme() + "://"			+ request.getServerName() + ":" + request.getServerPort()			+ path + "/"; %><%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%><%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%><!DOCTYPE html><html>  <head>    <title>${loginBean.cName} - 教师管理</title>    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport" />    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />    <base href="<%=basePath%>" />  </head>  <body class="contrast-red">    <%@ include file="/common/res.jsp" %>    <!-- 引入header头部 -->    <%@ include file="/common/header.jsp" %>     <div id="wrapper">      <!-- 引入左侧导航栏 -->      <%@ include file="/common/nav.jsp" %>      <section id="content">        <div class="container-fluid">          <div class="row-fluid" id="content-wrapper">            <div class="span12">              <div class="page-header">                <h1 class="pull-left">                  <i class="icon-edit"></i>                  <span>教师管理</span>                </h1>              </div>              <div class="row-fluid" style="">                <button class="btnNisal" type="button" style="margin-top: 0px;" id="siftBtn">筛选</button>              </div>              <hr class='hr-double' />              <div class="row-fluid" id="sift" style="display: none;">                <div class="span12 box">                  <div class="box-header purple-background">                    <div class="title">                      <div class="icon-pencil"></div>                      <b>筛选</b>                    </div>                    <div class="actions">                      <a href="#" class="btn box-collapse btn-mini btn-link"><i></i></a>                    </div>                  </div>                  <div class="box-content">                    <form id="" accept-charset="UTF-8" action="${pageContext.request.contextPath}/teacherMgr.html" class="form form-horizontal" method="get" style="margin-bottom: 0;" />                    <div style="margin:0;padding:0;display:inline">                    <input name="type" type="hidden" value="search" />                    <input name="page" type="hidden" value="0" />                    </div>                      <div class="control-group">                        <label class="control-label" for="inputSelect">选择学院</label>                        <div class="controls">                          <select id="" class='select2 input-block-level' name="academyId" style="width: 216px;">                           <option value=""></option>                            <c:forEach items="${academyMap}" var="academy">                            <option value="${academy.key}">${academy.value.cName}</option>                            </c:forEach>                          </select>                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="inputSelect">专业</label>                        <div class="controls">                          <select id="" class='select2 input-block-level' name="majorId" style="width: 216px;">                          <option value=""></option>                            <c:forEach items="${majorMap}" var="major">                                                          <option value="${major.key}">${major.value.majorChineseName}</option>                            </c:forEach>                          </select>                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="inputSelect">班级</label>                        <div class="controls">                          <select id="" class='select2 input-block-level' name="cclassId" style="width: 216px;">                          <option value=""></option>                            <c:forEach items="${classMap}" var="cclass">                                        <option value="${cclass.value.cclass.classId}">${cclass.value.cclass.cName}</option>                            </c:forEach>                          </select>                        </div>                      </div>                      <hr class='hr-normal' />                      <div class="control-group">                        <div class="controls">                          <button class="btnNisal" style="margin: 0px;" type="submit" id="">查询</button>                        </div>                      </div>                    </form>                  </div>                </div>                <hr class='hr-double' />              </div>              <div class="row-fluid" id="addTeacher">                <div class="span12 box">                  <div class="box-header purple-background">                    <div class="title">                      <div class="icon-user"></div>                      <b>添加教师</b><span style="color:red;">&nbsp;${error_msg}</span>                    </div>                    <div class="actions">                      <a href="#" class="btn box-collapse btn-mini btn-link"><i></i></a>                    </div>                  </div>                  <div class="box-content">                    <form id="addTeacherForm" accept-charset="UTF-8" action="${pageContext.request.contextPath}/teacherMgr.html" class="form form-horizontal" method="post" style="margin-bottom: 0;" />                    <div style="margin:0;padding:0;display:inline">                    <input name="type" type="hidden" value="add" />                    <input name="cclasIdstr" type="hidden" value="1;" />                                        </div>                      <input type="hidden" id="classInfo" name="" value="">                      <div class="control-group">                        <label class="control-label" for="">教师姓名</label>                        <div class="controls">                          <input class="" id="teacherName" name="fullName" placeholder="教师名称" type="text" />                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="">教师工号</label>                        <div class="controls">                          <input class="" id="teacherId" name="tcardNumber" placeholder="教师工号" type="text" />                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="">手机号</label>                        <div class="controls">                          <input class="" id="teacherTel" name="phone" placeholder="手机号" type="text" />                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="">邮箱</label>                        <div class="controls">                          <input class="" id="teacherMail" name="email" placeholder="邮箱" type="text" />                        </div>                      </div>                      <div class="control-group">                        <label class="control-label">性别</label>                        <div class="controls">                          <label class="radio inline">                            <input type="radio" value="1" name="gender" checked="checked" />                              	男                          </label>                          <label class="radio inline">                            <input type="radio" value="2" name="gender"/>                              	女                          </label>                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="">学院</label>                        <div class="controls">                          <select id="teacherCoggle" class='select2 input-block-level' name="academyId" style="width: 216px;">                            <c:forEach items="${academyMap}" var="academy">                              <option value="${academy.key}">${academy.value.cName}</option>                            </c:forEach>                          </select>                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="">专业</label>                        <div class="controls">                        <select id="teacherMajor" class='select2 input-block-level' name="majorId" style="width: 216px;">                            <c:forEach items="${majorMap}" var="major">                             <option value="${major.key}">${major.value.majorChineseName}</option>                           </c:forEach>                         </select>                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="">职称</label>                        <div class="controls">                        <select id="teacherProfe" class='select2 input-block-level' name="professionalTitleTypeId" style="width: 216px;">                            <c:forEach items="${ professionalTitleTypes}" var="professionalTitleType">                             <option value="${professionalTitleType.professionalTitleTypeId}">${professionalTitleType.cName}</option>                           </c:forEach>                         </select>                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="">所授班级</label>                        <div class="controls">                          <div>                          	<c:forEach items="${classMap}" var="cclass">                              <label class="checkbox-inline">                                <input class="proClasses" type="checkbox" id="" value="${cclass.key}">${cclass.value.cclass.cName}                              </label>                            </c:forEach>                          </div>                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="inputSelect">教师用户类型</label>                        <div class="controls">                                                    <label class="checkbox-inline">						    <input type="radio" name="userTypeId" id="" value="1" checked> 教师						  </label>						  <label class="checkbox-inline">						    <input type="radio" name="userTypeId" id="" value="2"> 管理员						  </label>						  <label class="checkbox-inline">						    <input type="radio" name="userTypeId" id="" value="3"> 系统管理员						  </label>                        </div>                      </div>                      <hr class='hr-normal' />                      <div class="control-group">                        <div class="controls">                          <button id="addTeacherBtn" class="btnNisal" style="margin: 0px;" type="submit">添加</button>                        </div>                      </div>                    </form>                  </div>                </div>                <hr class='hr-double' />              </div>              <div class="row-fluid">                <div class="span12 box bordered-box orange-border" style="margin-bottom:0;">                  <div class="box-header purple-background">                    <div class="title"><b>教师管理</b></div>                    <div class="actions">                      <a href="#" class="btn box-collapse btn-mini btn-link"><i></i></a>                    </div>                  </div>                  <div class="box-content box-no-padding">                    <div class="responsive-table">                      <div class="scrollable-area">                        <table class="data-table table table-bordered table-striped" style="margin-bottom:0;">                          <thead>                          <c:choose>                            <c:when test="${user.userTypeId==1 or user.userTypeId==2}">                             <tr>                              <th>教师姓名</th>                              <th>教师工号</th>                              <th>手机号</th>                              <th>邮箱</th>                              <th>性别</th>                              <th>学院</th>                              <th>专业</th>                              <th>职称</th>                              <th>所授班级</th>                              <th>教师用户类型</th>                              <th>操作</th>                              <th>删除</th>                            </tr>                            </c:when>                            <c:otherwise>                              <tr>                              <th>Teacher's Name</th>                              <th>Gender</th>                              <th>Card Number</th>                              <th>Academy</th>                              <th>Major</th>                              <th>Class</th>                              <th>ProfessionalTitle</th>                            </tr>                            </c:otherwise>                          </c:choose>                                                      </thead>                          <tbody>                          <c:forEach items="${teachers}" var="teacher">                           <tr>                              <td><span class="teaName">${teacher.fullName}</span></td>                              <td class="teaId">${teacher.apartmentRoll.cardNumber}</td>                              <td class="teaPhone">${teacher.phone}</td>                              <td class="teaMail">${teacher.email}</td>                              <td class="teaSex">                              <c:choose>                              	<c:when test="${teacher.gender==2}">                              		女                              	</c:when>                              	<c:otherwise>                              	           男                              	</c:otherwise>                              </c:choose>                              </td>                                                            <td class="teaCoggle">                              <c:forEach items="${teacher.amcOnUsers}" var="academy">                              	${academy.academy.cName}                              </c:forEach>                              </td>                              <td class="teaMajor">                              <c:forEach items="${teacher.amcOnUsers}" var="major">                              	${major.major.cName}                              </c:forEach>                              </td>                              <td class="teaJob">${teacher.apartmentRoll.fProfessionalTitleType.cName}</td>                              <td class="teaClasses">                                                            <c:forEach items="${teacher.amcOnUsers}" var="cclass">                              	${cclass.cclass.cName}                              </c:forEach>                              </td>                                                            <td class="teaType">${teacher.userType.cName}</td>                              <td class="update">修改<input type="hidden" value="${teacher.userId}"/></td>                              <td class="delete">删除<input type="hidden" value="${teacher.userId}"></td>                              </tr>                          </c:forEach>                          </tbody>                        </table>                      </div>                    </div>                  </div>                  <div class="paging">                    <a class="prev" href="${pageContext.request.contextPath}/teacherMgr.html?type=search&academyId=${tSearch.academyId}&majorId=${tSearch.majorId}&cclassId=${tSearch.cclassId}&page=${tSearch.page}">上一页</a>                    <a class="next" href="${pageContext.request.contextPath}/teacherMgr.html?type=search&academyId=${tSearch.academyId}&majorId=${tSearch.majorId}&cclassId=${tSearch.cclassId}&page=${tSearch.page}">下一页</a>                    <input onkeydown="onlyNum();" type="text" name="" value="" placeholder="页码">                    <span class="nowPage">1</span>/<span class="maxPage">1</span>                    <a class="trun" href="">跳转</a>                  </div>                </div>              </div>                            <hr class="hr-double">              <div class="row-fluid" id="updateTeaInfo" style="display: none;">                <div class="span12 box bordered-box orange-border" style="margin-bottom:0;">                  <div class="box-header purple-background">                    <div class="title"><b>信息修改</b></div>                    <div class="actions">                      <a href="#" class="btn box-collapse btn-mini btn-link"><i></i></a>                    </div>                  </div>                  <div class="box-content box-no-padding">                   <form id="" accept-charset="UTF-8" action="#" class="form form-horizontal" method="post" style="margin-bottom: 0;" />                   <div style="margin:0;padding:0;display:inline">                   <input name="utf8" type="hidden" value="&#x2713;" />                   <input name="authenticity_token" type="hidden" value="CFC7d00LWKQsSahRqsfD+e/mHLqbaVIXBvlBGe/KP+I=" />                   </div>                      <input type="hidden" id="chgTeacherInfo" name="" value="">                      <div class="control-group" style="margin-top: 20px;">                        <label class="control-label" for="">教师姓名</label>                        <div class="controls">                          <input class="" id="chgName" placeholder="教师名称" type="text" />                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="">教师工号</label>                        <div class="controls">                          <input class="" id="chgId" placeholder="教师工号" type="text" />                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="">手机号</label>                        <div class="controls">                          <input class="" id="chgPhone" placeholder="手机号" type="text" />                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="">邮箱</label>                        <div class="controls">                          <input class="" id="chgMail" placeholder="邮箱" type="text" />                        </div>                      </div>                      <div class="control-group">                        <label class="control-label">性别</label>                        <div class="controls">                          <label class="radio inline">                            <input class="chgSex man" type="radio" value="1" name="sex"/>                              男                          </label>                          <label class="radio inline">                            <input class="chgSex woman" type="radio" value="2" name="sex"/>                              女                          </label>                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="">学院</label>                        <div class="controls">                          <select id="chgCoggle" class='select2 input-block-level' name="academyId" style="width: 216px;">                            <c:forEach items="${academyMap}" var="academy">                              <option value="${academy.key}">${academy.value.cName}</option>                            </c:forEach>                          </select>                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="">专业</label>                        <div class="controls">                        <select id="chgMajor" class='select2 input-block-level' name="majorId" style="width: 216px;">                            <c:forEach items="${majorMap}" var="major">                             <option value="${major.key}">${major.value.majorChineseName}</option>                           </c:forEach>                         </select>                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="">职称</label>                        <div class="controls">                          <select id="chgJob" class="select2 input-block-level" style="width: 216px;">                            <c:forEach items="${ professionalTitleTypes}" var="professionalTitleType">                             <option value="${professionalTitleType.professionalTitleTypeId}">${professionalTitleType.cName}</option>                           </c:forEach>                          </select>                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="">所授班级</label>                        <div class="controls">                          <div>                          	<c:forEach items="${classMap}" var="cclass">                              <label class="checkbox-inline chgClasses">                                <input class="proClasses" type="checkbox" id="" value="${cclass.key}">${cclass.value.cclass.cName}                              </label>                            </c:forEach>                          </div>                        </div>                      </div>                      <div class="control-group">                        <label class="control-label" for="inputSelect">教师用户类型</label>                        <div class="controls">                          <select id="chgTeacherType" class='select2 input-block-level ' style="width: 216px;">                            <option value="3">教师</option>                            <option value="2">管理员</option>                            <option value="1">系统管理员</option>                          </select>                        </div>                      </div>						<input type='hidden' id="chgUserId">                      <hr class='hr-normal' />                      <div class="control-group">                        <div class="controls">                          <button id="chgTeacherBtn" class="btnNisal" style="margin: 0px;" type="button">添加</button>                        </div>                      </div>                    </form>                  </div>                </div>              </div>                          </div>          </div>        </div>      </section>    </div>	<script>      var nowPage = parseInt($(".nowPage").html());      $(".prev").click(function(){        if(nowPage <= 1){          layer.msg("已经是第一页了");          return false;        }         window.location.href = window.location.href.replace(/\d{1,}$/g, nowPage - 1);      });      $(".next").click(function(){        if(nowPage >= parseInt($(".maxPage").html())){          layer.msg("已经是最后一页了");          return false;        }         window.location.href = window.location.href.replace(/\d{1,}$/g, nowPage + 1);      });      function onlyNum() {        if(!(event.keyCode==46)&&!(event.keyCode==8)&&!(event.keyCode==37)&&!(event.keyCode==39))        if(!((event.keyCode>=48&&event.keyCode<=57)||(event.keyCode>=96&&event.keyCode<=105)))        event.returnValue=false;      }      $(document).ready(function(){        $("#updateForm").hide();        $(".paging .trun").click(function(){          var page = $(".paging input").val();          if(page === ""){            layer.msg("请填入页码");            return false;          }          var link = window.location.href;          var src  = link.replace(/\d{1,}$/g, page);          window.location.href = src;          return false;        });      });               </script>   <script type="text/javascript">      $(document).ready(function(){    	  $('.delete').click(function(){    		  var id = $(this).find('input').val();        	  $.ajax({        		type:'POST',        		url:'./teacherMgr.html',        		data:{        			'type':'del',        			'id':id        		},        		dataType:'json',        		success:function(data){        			if(data.success){        				window.location.reload();         			}        		},        		error:function(jqXHR){        			layer.msg("发生错误："+jqXHR.status);        		}        	  })          });        var updaterJson = "";        $("#siftBtn").click(function(){          $("#sift").slideToggle();        });        $("#addTeacherBtn").click(function(){          var str = "";          var classer = $(".proClasses");          var flag = 0;          classer.each(function(){            if($(this).attr("checked") === "checked"){              str = str + $(this).val() + ";";              flag = 1;            }           });          if(!flag){            layer.msg("请填写所有信息")            return false;          }          var teacherName   = $("#teacherName").val();                    var teacherId     = $("#teacherId").val();                    var teacherTel    = $("#teacherTel").val();                    var teacherMail   = $("#teacherMail").val();                    var teacherCoggle = $("#teacherCoggle").val();                    var teacherMajor  = $("#teacherMajor").val();                    var teacherProfe  = $("#teacherProfe").val();                    var teacherType   = $("#teacherType").val();                      if(teacherName === "" || teacherId === "" || teacherTel === ""||             teacherMail === "" || teacherCoggle === "" || teacherMajor === "" ||             teacherProfe === "" || teacherType === ""          ){            layer.msg("请填写所有信息")            return false;          }          $("#classInfo").val(str);          $("#addTeacherForm").submit();        });        function getTeaInfo(obj){return $(this).find(obj).html();}        $(".update").click(function(){          var oParent = $(this).parent();          var sex     = getTeaInfo.call(oParent, '.teaSex');          var coggle  = getTeaInfo.call(oParent, '.teaCoggle');          var classes = getTeaInfo.call(oParent, '.teaClasses').split(" ");          var type    = getTeaInfo.call(oParent, '.teaType');          var major   = getTeaInfo.call(oParent, '.teaMajor');          var job     = getTeaInfo.call(oParent, '.teaJob');          $('.proClasses').removeAttr('checked');          $("#chgName").val(getTeaInfo.call(oParent, '.teaName'));          $("#chgId").val(getTeaInfo.call(oParent, '.teaId'));          $("#chgPhone").val(getTeaInfo.call(oParent, '.teaPhone'));          $("#chgMail").val(getTeaInfo.call(oParent, '.teaMail'));          $("#chgUserId").val($(this).parent().find('input').val());          sex === "男" ? $(".man").attr("checked", "checked") : $(".woman").attr("checked", "checked")           $("#chgCoggle").find("option").each(function(){            if($(this).html() === $.trim(coggle)){              $("#chgCoggle").val($(this).val());              $("#chgCoggle").parent().find('span').html(coggle);            }          });          $(".chgClasses").each(function(){            for(var i = 0; i < classes.length; i ++){if($.trim($(this).text()) === $.trim(classes[i])) $(this).find('input').attr("checked", "checked");}          });          $("#chgTeacherType").find("option").each(function(){            if($(this).html() === $.trim(type)){              $("#chgTeacherType").val($(this).val());              $("#chgTeacherType").parent().find('span').html(type);            }          });          $("#chgMajor").find("option").each(function(){            if($(this).html() === $.trim(major)){              $("#chgMajor").val($(this).val());              $("#chgMajor").parent().find('span').html(major);            }          });          $("#chgJob").find("option").each(function(){            if($(this).html() === $.trim(job)){              $("#chgJob").val($(this).val());              $("#chgJob").parent().find('span').html(job);            }          });                    $.ajax({            type: "POST",            url: './teacherMgr.html',            data: {              'type': 'detail',              'id': $(this).parent().find('input').val()            },            dataType: "json",            success: function(data){            	updaterJson = JSON.stringify(data);            },            error: function(jqXHR){               layer.msg("发生错误：" + jqXHR.status);            },          });          $('#updateTeaInfo').slideDown();        });        $("#chgTeacherBtn").click(function(){          var name    = $("#chgName").val();          var id      = $("#chgId").val();          var phone   = $("#chgPhone").val();          var mail    = $("#chgMail").val();          var sex     = $(".man").attr("checked") === "checked" ? "男" : "女";          var coggle  = $("#chgCoggle").val();          var major   = $("#chgMajor").val();          var job     = $("#chgJob").val();          var classes = "";          var type    = $("#chgTeacherType").val();          var userId  = $("#chgUserId").val();          sex = sex === "男" ? "1" : "2";          $(".chgClasses").each(function(){            if($(this).find("input").attr("checked") === "checked") classes += $.trim($(this).text()) + ";";          });          if(name === "" || id === "" || phone === "" || mail === "" ||              sex === "" || coggle === "" || major === "" ||              job === "" || classes === "" || type === ""){            layer.msg('<span stype="font-size: 20px;">请填写所有信息</span>');            return false;          }          var updateObj = JSON.parse(updaterJson);          var tempObj = JSON.stringify(updateObj.amcOnUsers);          updateObj.amcOnUsers.length = 0;          var oUser = [];          var classArr = classes.split(";");          for(var i = 0; i < classArr.length - 1; i ++){            var obj = {              "academy": '',              "academyId": 1,              "cclass": '',              "classId": 1,              "id": 0,              "major": '',              "majorId": 1,              "status": 1,              "user": '',              "userId": 3            }            obj.academyId = coggle;            $(".chgClasses").each(function(){              if($.trim($(this).text()) === classArr[i]) obj.classId = $(this).find('input').val();            });            obj.majorId = major;            obj.userId = userId;            oUser.push(obj);                      }                    // var tempObj = JSON.parse(tempObj);          updateObj.fullName = name;          updateObj.apartmentRoll.cardNumber = id;          updateObj.phone = phone;          updateObj.email = mail;          updateObj.gender = sex;          updateObj.apartmentRoll.professionalTitleTypeId = job;          updateObj.userTypeId = type;          //alert(tempObj);          tempObj = JSON.parse(tempObj);      	  for(i in oUser){      		for(j in tempObj){      			if(tempObj[j].classId == oUser[i].classId){      				oUser[i].id = tempObj[j].id;      			}      		}      	  }         //alert(JSON.stringify(oUser));		  $.ajax({            type: "POST",            url: './teacherMgr.html',            data: {              'teacher': JSON.stringify(updateObj),              'amcOnUsers': JSON.stringify(oUser),              'type': 'update'            },            dataType: "JSON",            success: function(data){              if(data.success){            	  window.location.reload();                }           	  layer.msg(data.msg);            },            error: function(jqXHR){               layer.msg("发生错误：" + jqXHR.status);            },          });                });      });    </script>  </body></html>